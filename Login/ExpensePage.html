<!DOCTYPE html>
<html>
    <head>

    </head>
    <body>
        <form onsubmit="addingExpense(event)">
            EXPENDITURE:<input type="text" id="expenditure" required>
            DESCRIPTION:<input type="text" id="description" >
            CATEGORY:<select id="category" width="100px">
                <option value="fuel">Fuel</option>
                <option value="food">Food</option>
                <option value="Entertainment">Entertainment</option>
                <option value="study">Study</option>
                <option value="other">Others</option>
            </select>
            <button class="block" type="Submit">ADD EXPENSES</button>
            <br>

        </form>
        <button id="rzp-button1">Buy Premium Membership</button>

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
        <ui id="list"></ui>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>

        
        <script>
            function addingExpense(event){
                const EXPENDITURE=document.getElementById('expenditure').value
                const DESCRIPTION=document.getElementById('description').value
                const CATEGORY=document.getElementById('category').value
                
                const id=localStorage.getItem('token')
                event.preventDefault()

                


                expenseDetails={
                    EXPENDITURE,
                    DESCRIPTION,
                    CATEGORY

                }
                const token=localStorage.getItem('token')


                axios.post("http://localhost:3000/ExpenseForm",expenseDetails,{headers:{
                        'Authorization':token}})
                    .then((res)=>{

                        

                        alert('succesfully added')
                        showProductOnScreen(res.data)


                })
            }
            window.addEventListener("DOMContentLoaded",async() => {
               
                const token=localStorage.getItem('token')


                axios.get("http://localhost:3000/ExpenseDetails",{headers:{
                        'Authorization':token}})
                .then((res)=>{
                    for(var i=0;i<res.data.length;i++){
                        showProductOnScreen(res.data[i])
                        

                    }
                    

                })

                

            })
            function showProductOnScreen(expense){
                const parentNode=document.getElementById('list')
                const childHTML=`<li id=${expense.id}> ${expense.Expenditure}-${expense.Description}-${expense.Category}
                    <button onclick="deleteInfo(${expense.id})">DELETE</button>
                    </li>`
                    parentNode.innerHTML+=childHTML
                    
            }
            function deleteInfo(id){
                const token=localStorage.getItem('token')


                axios.delete('http://localhost:3000/DeleteInfo',{headers:{
                        'Authorization':token}})
            }
          
            document.getElementById('rzp-button1').onclick=async function(e){
                const token=localStorage.getItem('token')
                const response=await axios.get('http://localhost:3000/purchase/premiumMembership',{
                    headers: {"Authorization": token}

                })

                var options={
                "key": response.data.key_id, // Enter the Key ID generated from the Dashboar "order_id": response.data.order.id, // For one time payment // This handler function will handle the success payment "handler": async function (response) [ await axios.post('http://localhost:3000/purchase/updatetransactionstatus
                'order_id':response.data.order.id,
                'handler': async function(response){
                    console.log(response)

                    await axios.post('http://localhost:3000/purchase/updateTransactionStatus',{
                    
                        
                    order_id: options.order_id, 
                    payment_id: response.razorpay_payment_id,
                }, { headers: {"Authorization": token}})
                    alert('You are a Premium User Now')
                    document.getElementById('rzp-button1').style.display='block'
            

            }
        }
    
            const rzp1=new Razorpay(options)
            rzp1.open()
            event.preventDefault()
            
    }          


        </script>
    </body>
</html>